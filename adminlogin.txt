# ADMIN LOGIN & SETUP GUIDE - Climate Health Tracker

## üîê How Admin Login Works

There are **TWO WAYS** to create and login as an admin:

---

## METHOD 1: Using Superuser (Recommended for First Admin)

### Step 1: Create Superuser Account
```bash
python manage.py createsuperuser
```

Follow the prompts:
- **Username**: admin
- **Email address**: admin@example.com
- **Password**: ********
- **Password (again)**: ********

### Step 2: Create Admin Profile for Superuser
```bash
python manage.py shell
```

Then run this code:
```python
from django.contrib.auth.models import User
from health_reports.models import UserProfile

# Get the superuser you just created
admin_user = User.objects.get(username='admin')

# Create or update their profile to be admin
profile, created = UserProfile.objects.get_or_create(
    user=admin_user,
    defaults={
        'role': 'admin',
        'organization': 'Health Department'
    }
)

# If profile already exists, update it
if not created:
    profile.role = 'admin'
    profile.organization = 'Health Department'
    profile.save()

print(f"Admin profile created/updated for {admin_user.username}")
exit()
```

### Step 3: Login as Admin
1. Go to: http://127.0.0.1:8000/login/
2. Username: **admin** (or whatever you created)
3. Password: (your superuser password)
4. Click **Login**
5. You'll see the **Admin Panel** link in the navigation bar

---

## METHOD 2: Register Through Website

### Step 1: Register New Account
1. Go to: http://127.0.0.1:8000/register/
2. Fill in the registration form:
   - **Username**: healthofficial
   - **Email**: official@health.gov
   - **First Name**: John
   - **Last Name**: Doe
   - **Password**: (choose strong password)
   - **Confirm Password**: (same password)
   - **Phone**: 1234567890
   - **Account Type**: Select **"Health Official (requires approval)"**
   - **Organization**: "Municipal Health Department" (required for admins)

3. Click **Register**

### Step 2: Approve Admin Role (Using Django Admin Panel)
1. Login to Django Admin Panel: http://127.0.0.1:8000/admin/
2. Use your **superuser credentials** (created in Method 1)
3. Click on **User Profiles** under "HEALTH_REPORTS"
4. Find the user you just registered
5. Click on their profile
6. Change **Role** from "Public User" to "Health Official/Admin"
7. Click **Save**

### Step 3: Login as Admin
1. Logout from superuser account
2. Go to: http://127.0.0.1:8000/login/
3. Username: **healthofficial** (what you registered)
4. Password: (your registration password)
5. Click **Login**
6. You'll now see the **Admin Panel** link in navigation

---

## üéØ Complete Setup Script (Run Once)

Save this as `create_admin.py` in your project root and run it:

```python
# create_admin.py
import os
import django

os.environ.setdefault('DJANGO_SETTINGS_MODULE', 'climate_health_tracker.settings')
django.setup()

from django.contrib.auth.models import User
from health_reports.models import UserProfile

def create_admin_user():
    # Check if admin already exists
    if User.objects.filter(username='admin').exists():
        print("Admin user already exists!")
        admin_user = User.objects.get(username='admin')
    else:
        # Create superuser
        admin_user = User.objects.create_superuser(
            username='admin',
            email='admin@climatehealthtracker.com',
            password='admin123',  # CHANGE THIS PASSWORD!
            first_name='Admin',
            last_name='User'
        )
        print("‚úì Superuser created successfully!")
    
    # Create or update admin profile
    profile, created = UserProfile.objects.get_or_create(
        user=admin_user,
        defaults={
            'role': 'admin',
            'phone': '1234567890',
            'organization': 'Central Health Department'
        }
    )
    
    if not created:
        profile.role = 'admin'
        profile.organization = 'Central Health Department'
        profile.save()
        print("‚úì Admin profile updated!")
    else:
        print("‚úì Admin profile created!")
    
    print("\n" + "="*50)
    print("ADMIN CREDENTIALS:")
    print("="*50)
    print(f"Username: admin")
    print(f"Password: admin123")  # CHANGE THIS!
    print(f"Login URL: http://127.0.0.1:8000/login/")
    print("="*50)
    print("\n‚ö†Ô∏è  IMPORTANT: Change the password after first login!")

if __name__ == '__main__':
    create_admin_user()
```

Run it with:
```bash
python create_admin.py
```

---

## üîç Verify Admin Access

### After logging in as admin, you should see:

1. **Navigation Bar** includes:
   - Submit Report
   - Analytics
   - My Dashboard
   - **Admin Panel** ‚Üê This confirms admin access

2. **Admin Dashboard Features**:
   - View all submitted reports
   - Filter reports by status
   - Review and verify reports
   - Update report status
   - Add admin notes
   - Create health advisories

3. **Report Detail Page** (as admin):
   - Can see "Admin Actions" section
   - Can update report status
   - Can add admin notes/response

---

## üö® Troubleshooting

### Problem: "Admin Panel" link not showing after login

**Solution 1: Check User Profile**
```bash
python manage.py shell
```
```python
from django.contrib.auth.models import User
from health_reports.models import UserProfile

# Replace 'yourusername' with your username
user = User.objects.get(username='yourusername')
print(f"User: {user.username}")
print(f"Has profile: {hasattr(user, 'profile')}")

if hasattr(user, 'profile'):
    print(f"Role: {user.profile.role}")
    print(f"Is Admin: {user.profile.is_admin()}")
else:
    # Create profile
    UserProfile.objects.create(user=user, role='admin', organization='Health Dept')
    print("Profile created!")

exit()
```

**Solution 2: Update Existing Profile**
```bash
python manage.py shell
```
```python
from django.contrib.auth.models import User

user = User.objects.get(username='yourusername')
user.profile.role = 'admin'
user.profile.save()
print("Updated to admin!")
exit()
```

### Problem: Can't access Django Admin Panel (http://127.0.0.1:8000/admin/)

**Solution:**
Only **superusers** can access Django Admin Panel. Create one with:
```bash
python manage.py createsuperuser
```

---

## üìù Summary: Quick Admin Creation

### For First Time Setup:
```bash
# 1. Create superuser
python manage.py createsuperuser

# 2. Create admin profile
python manage.py shell
```
```python
from django.contrib.auth.models import User
from health_reports.models import UserProfile

user = User.objects.get(username='admin')
UserProfile.objects.create(user=user, role='admin', organization='Health Dept')
exit()
```

### Login Credentials:
- **URL**: http://127.0.0.1:8000/login/
- **Username**: admin (or what you created)
- **Password**: (your superuser password)

### Test Admin Access:
1. Login at http://127.0.0.1:8000/login/
2. Check if "Admin Panel" appears in navigation
3. Click "Admin Panel" to access admin dashboard
4. Try reviewing a report to confirm admin features work

---

## üéØ Default Test Accounts (if you run the sample data script)

### Admin Account:
- Username: **admin**
- Password: (set during createsuperuser)
- Role: Admin/Health Official

### Test User Account:
- Username: **testuser**
- Password: **testpass123**
- Role: Public User

---

## üîê Security Best Practices

1. **Change default passwords** immediately after first login
2. **Use strong passwords** for production
3. **Don't share admin credentials**
4. **Review admin users regularly**
5. **Use environment variables** for sensitive data in production

---

## üìû Quick Reference

| Action | Command/URL |
|--------|-------------|
| Create Superuser | `python manage.py createsuperuser` |
| Django Admin Panel | http://127.0.0.1:8000/admin/ |
| App Login Page | http://127.0.0.1:8000/login/ |
| Register Page | http://127.0.0.1:8000/register/ |
| Admin Dashboard | http://127.0.0.1:8000/admin-dashboard/ |
| Check User Role | Use Django shell commands above |

---

## ‚úÖ Verification Checklist

After setting up admin:
- [ ] Created superuser account
- [ ] Created UserProfile with role='admin'
- [ ] Can login at /login/
- [ ] "Admin Panel" link visible in navigation
- [ ] Can access admin dashboard
- [ ] Can review and update reports
- [ ] Can create health advisories

---

That's it! You're now ready to use the admin features of the Climate Health Tracker application.